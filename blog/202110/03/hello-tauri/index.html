<!DOCTYPE html>
<html><head lang="ja">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tauri を GUI にして Rust と React に入門する - 発火後忘失</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="
はじめに


Tauri という、 WebView を利用して GUI を実現する Rust 製フレームワークを試してみました。


Rust も React も入門書から陸続きで書き始められるので、余計なことに気を取られずに済みそうです(ただし、 JS - Rust 間のデータ受け渡しに利用する JSON オブジェクトのシリアライズ/デシリアライズに利用する Serde についての知識は少し必要になりそうでした)。
" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://yukihane.github.io/blog/202110/03/hello-tauri/">
  <meta property="og:site_name" content="発火後忘失">
  <meta property="og:title" content="Tauri を GUI にして Rust と React に入門する">
  <meta property="og:description" content="はじめに Tauri という、 WebView を利用して GUI を実現する Rust 製フレームワークを試してみました。
Rust も React も入門書から陸続きで書き始められるので、余計なことに気を取られずに済みそうです(ただし、 JS - Rust 間のデータ受け渡しに利用する JSON オブジェクトのシリアライズ/デシリアライズに利用する Serde についての知識は少し必要になりそうでした)。">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2021-10-03T08:20:21+00:00">
    <meta property="article:modified_time" content="2021-10-03T08:20:21+00:00">
    <meta property="article:tag" content="Rust">
    <meta property="article:tag" content="React">
    <meta property="article:tag" content="Tauri">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Tauri を GUI にして Rust と React に入門する">
  <meta name="twitter:description" content="はじめに Tauri という、 WebView を利用して GUI を実現する Rust 製フレームワークを試してみました。
Rust も React も入門書から陸続きで書き始められるので、余計なことに気を取られずに済みそうです(ただし、 JS - Rust 間のデータ受け渡しに利用する JSON オブジェクトのシリアライズ/デシリアライズに利用する Serde についての知識は少し必要になりそうでした)。">

        <link href="https://yukihane.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://yukihane.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://yukihane.github.io/">発火後忘失</a>
	</div>
	<nav>
		
		<a href="blog">Blog</a>
		
		<a href="docs">Docs</a>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Tauri を GUI にして Rust と React に入門する</h1>
          <div class="meta">Posted on 2021/10/03</div>
        </div>
        
        <section class="body">
          <div class="sect1">
<h2 id="_はじめに">はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://tauri.studio/">Tauri</a> という、 WebView を利用して GUI を実現する Rust 製フレームワークを試してみました。</p>
</div>
<div class="paragraph">
<p>Rust も React も入門書から陸続きで書き始められるので、余計なことに気を取られずに済みそうです(ただし、 JS - Rust 間のデータ受け渡しに利用する JSON オブジェクトのシリアライズ/デシリアライズに利用する <a href="https://serde.rs/">Serde</a> についての知識は少し必要になりそうでした)。</p>
</div>
<div class="paragraph">
<p>本エントリは、 Tauri で Hello World するアプリケーションを作成しビルドしてみた過程の記録です。
次のような処理を行うプログラムを作成しました。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JS 側でパラメータを伴った <a href="https://tauri.studio/en/docs/usage/guides/command/">コマンド</a> をリクエスト</p>
</li>
<li>
<p>Rust 側でパラメータを基に計算を実行</p>
</li>
<li>
<p>計算結果を JS 側に返して出力</p>
</li>
</ul>
</div>
<div class="paragraph">
<figure><img src="/20211003/tauri-app.png">
</figure>

</div>
<div class="paragraph">
<p>今回実装したコードはこちらです:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/yukihane/hello-rust/tree/master/hello-tauri" class="bare">https://github.com/yukihane/hello-rust/tree/master/hello-tauri</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_環境">環境</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>yarn tauri info</code> コマンド実行結果より。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ubuntu 20.04</p>
</li>
<li>
<p>Tauri 1.0.0-beta.8</p>
</li>
<li>
<p>Rust 1.55.0</p>
</li>
<li>
<p>Node 14.18.0</p>
</li>
<li>
<p>React 17.0.2</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_初期セットアップ">初期セットアップ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>公式ドキュメントに従って進めるだけです。
私は前述の通り Ubuntu 上で開発しているので、 <a href="https://tauri.studio/en/docs/getting-started/setup-linux">Setup for Linux</a> の Debian の項に書かれているパッケージをそのままインストールしました｡</p>
</div>
<div class="paragraph">
<p>Node や Rust 開発環境は既にセットアップしていたものをそのまま利用しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_プロジェクト雛形作成と起動">プロジェクト雛形作成と起動</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://tauri.studio/en/docs/usage/development/integration">Integrate with Tauri</a> 章をそのまま実行するだけです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yarn create tauri-app</pre>
</div>
</div>
<div class="paragraph">
<p>上記コマンドを実行すると、いくつか作成する雛形について質問されます。</p>
</div>
<div class="paragraph">
<p>例えば JS フレームワークについて。
私は create-react-app を選択しました。
この後さらに TypeScript テンプレートを利用するか聞かれます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>? What UI recipe would you like to add?
❯ Vanilla.js (html, css, and js without the bundlers)
  create-react-app (https://create-react-app.dev/)
  create-vite (https://vitejs.dev/guide/#scaffolding-your-first-vite-project)
  Vue CLI (https://cli.vuejs.org/)
  Angular CLI (https://angular.io/cli)
  Svelte (https://github.com/sveltejs/template)
  Dominator (https://crates.io/crates/dominator/)</pre>
</div>
</div>
<div class="paragraph">
<p>コマンド実行が正常終了すると、次のようなファイル/ディレクトリが生成されます。</p>
</div>
<div class="paragraph">
<p>create-react-app(以降CRA)で生成したプロジェクトテンプレートに加えて、 <code>src-tauri</code> というディレクトリが生成されています。この後 <code>src-tauri</code> が Rust 側のプロジェクトです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── README.md
├── node_modules
├── package.json
├── public
├── src
├── src-tauri
├── tsconfig.json
└── yarn.lock</pre>
</div>
</div>
<div class="paragraph">
<p>プロジェクトテンプレートが作成できたら次のコマンドで起動できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yarn tauri dev</pre>
</div>
</div>
<div class="paragraph">
<p>まずCRAの <code>yarn start</code> と同じくウェブブラウザが起動し、その後 Rust のコンパイル完了後に Tauri アプリケーションが起動します。
JS に閉じたアプリケーションであれば、 CRA と同じくウェブブラウザの方を見て開発できそうですが、 API を利用して Rust 側とコミュニケーションする場合は、ウェブブラウザの方は API にアクセスするとエラーになるので利用できません。
(補足: どうもこの挙動は不具合だったらしく、 <a href="https://github.com/tauri-apps/tauri/issues/2793"><code>#2793</code></a> で対応が入ったようです)</p>
</div>
<div class="paragraph">
<p>パッケージングは次のコマンドです。
<code>--verbose</code> は必須ではありませんが、付けないと何か問題が発生した場合でもほとんど情報が出ませんでした。</p>
</div>
<div class="paragraph">
<p><code>yarn tauri build --verbose</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_実装">実装</h2>
<div class="sectionbody">
<div class="paragraph">
<p>上記で作成したプロジェクトテンプレートに <a href="https://tauri.studio/en/docs/usage/guides/command">Create Rust Commands</a> を参照しながら実装していきます。</p>
</div>
<div class="paragraph">
<p>まず、 <a href="https://github.com/yukihane/hello-rust/blob/master/hello-tauri/src/App.tsx">JS 側を実装</a>しました(重要でない行は適当に省略しています。全コードはリンク先参照)。</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/yukihane/hello-rust/blob/master/hello-tauri/src/App.tsx">src/App.tsx</a></div>
<div class="content">
<pre>import { invoke } from &#34;@tauri-apps/api&#34;;

function App() {

  const [message, setMessage] = useState(&#34;&#34;);

  const submit = () =&gt; {
    const data: Request = { personalData: { name, birthDay } };
    invoke&lt;Response&gt;(&#34;greet&#34;, data).then((resp) =&gt; {
      setMessage(resp.message);
    });
  };

  return (...);
}</pre>
</div>
</div>
<div class="paragraph">
<p><code>invoke</code> 関数の第1引数にコマンド名、第2引数にJSONでコマンドパラメータを設定し呼び出します。
戻り値は <code>Promise</code> 型です。</p>
</div>
<div class="paragraph">
<p>続いてこのコマンドに対応する処理を <a href="https://github.com/yukihane/hello-rust/blob/master/hello-tauri/src-tauri/src/main.rs">Rust 側に実装</a>します。</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/yukihane/hello-rust/blob/master/hello-tauri/src-tauri/src/main.rs">src-tauri/src/main.rs</a></div>
<div class="content">
<pre>#![cfg_attr(
  all(not(debug_assertions), target_os = &#34;windows&#34;),
  windows_subsystem = &#34;windows&#34;
)]

use chrono::{DateTime, Datelike, Local, Utc};
use serde::{Deserialize, Serialize};

#[derive(Deserialize, Debug)]
struct PersonalData {
  name: String,
  birthDay: DateTime&lt;Utc&gt;,
}

#[derive(Serialize, Debug)]
struct Response {
  message: String,
}

#[tauri::command]
fn greet(personal_data: PersonalData) -&gt; Response {
  println!(&#34;recieve: {:?}&#34;, personal_data);
  let age: i32 = calc_age(&amp;personal_data.birthDay, &amp;Local::now());
  let message = format!(&#34;こんにちは, {}({}歳)！&#34;, personal_data.name, age);

  Response { message }
}

fn calc_age(birth_day: &amp;DateTime&lt;Utc&gt;, now: &amp;DateTime&lt;Local&gt;) -&gt; i32 {
  let year = now.year() - birth_day.year();
  let delta = match now.month() as i32 - birth_day.month() as i32 {
    m if m &gt; 0 =&gt; 0,
    m if m &lt; 0 =&gt; -1,
    _ =&gt; {
      if now.day() as i32 - birth_day.day() as i32 &gt;= 0 {
        0
      } else {
        -1
      }
    }
  };

  year + delta
}

fn main() {
  tauri::Builder::default()
    .invoke_handler(tauri::generate_handler![greet])
    .run(tauri::generate_context!())
    .expect(&#34;error while running tauri application&#34;);
}</pre>
</div>
</div>
<div class="paragraph">
<p>コマンド名と同じ名前の関数を定義し <code>#[tauri::command]</code> アトリビュートを付与、 builder の <code>invoke_handler</code> 関数の引数に設定します。</p>
</div>
<div class="paragraph">
<p>引数や戻り値は JS の JSON と Rust の構造体に(基本的には(?) <code>Serde</code> の自動で)相互変換されるようでした。</p>
</div>
<div class="paragraph">
<p>命名規則は決まっており、名前や型が異なると呼び出されませんでした(意図通り動かなかった場合、原因を探すのが少し大変そうです)。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_大変そう大変だったところ">大変そう/大変だったところ</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>冒頭でも少し触れましたが、 <a href="https://serde.rs/">Serde</a> という crate が JS - Rust 間データ変換を担っているので、この crate の知識が少し必要になりそうでした。</p>
<div class="ulist">
<ul>
<li>
<p>今回のコードでいうと、 <code>Date</code> 型のオブジェクトを渡すのに <a href="https://github.com/yukihane/hello-rust/blob/d18f92e49f5bbe3a50cece81469fc29b31d1cd21/hello-tauri/src-tauri/Cargo.toml#L20"><code>Cargo.toml</code> の dependencies</a> に <code>chrono = { version = &#34;0.4.19&#34;, features = [&#34;serde&#34;] }</code> を追加する必要がありましたが、解答に辿り着くまで結構時間がかかりました。</p>
</li>
</ul>
</div>
</li>
<li>
<p>解説やサンプルが少ないです。公式/非公式ドキュメントも少なく、 <a href="https://tauri.studio/en/showcase">showcase</a> からリンクされているコードを理解しようにも、まず動かすまでにも至れなかったりしました。</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/tauri-apps/tauri/tree/next/examples">公式リポジトリの examples</a> が数少ない情報源でした。今回のことについては <a href="https://github.com/tauri-apps/tauri/tree/next/examples/commands">commands</a> が該当します。</p>
</li>
<li>
<p>examples 以下のコードを実行するには、リポジトリをチェックアウトして <code>cargo run --example commands</code> (など)。</p>
</li>
</ul>
</div>
</li>
<li>
<p>現状、 JS - Rust 間のやりとりは JSON のみなので、例えばバイナリを高頻度で送受信する必要があるようなアプリケーションではパフォーマンス問題が表出しそうにも思われます。</p>
<div class="ulist">
<ul>
<li>
<p>refs: <a href="https://github.com/tauri-apps/tauri/issues/1271">Pass messages between Rust frontend and backend without JSON serialization #1271</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/rust">rust</a></li>
              
              <li><a href="/tags/react">react</a></li>
              
              <li><a href="/tags/tauri">tauri</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2025  &amp;copy;{year}, All Rights Reserved |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-E9J8FN5B4Q"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-E9J8FN5B4Q');
        }
      </script>

</div>
    </body>
</html>
