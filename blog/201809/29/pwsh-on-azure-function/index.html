<!DOCTYPE html>
<html><head lang="ja">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Azure FunctionsでPowerShell使えなくなっとる - 発火後忘失</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="v1 で実験的サポートだった PowerShell が、実行環境のバージョンが上がったとかで v2 になり、選べなくなっているみたい？一時的な話？
実行環境を作る
https://portal.azure.com/ から 「リソースの作成」「Serverless Function App」と選択していきます。" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://yukihane.github.io/blog/201809/29/pwsh-on-azure-function/">
  <meta property="og:site_name" content="発火後忘失">
  <meta property="og:title" content="Azure FunctionsでPowerShell使えなくなっとる">
  <meta property="og:description" content="v1 で実験的サポートだった PowerShell が、実行環境のバージョンが上がったとかで v2 になり、選べなくなっているみたい？一時的な話？
実行環境を作る https://portal.azure.com/ から 「リソースの作成」「Serverless Function App」と選択していきます。">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2018-09-29T19:51:56+00:00">
    <meta property="article:modified_time" content="2018-09-29T19:51:56+00:00">
    <meta property="article:tag" content="Azure">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Azure FunctionsでPowerShell使えなくなっとる">
  <meta name="twitter:description" content="v1 で実験的サポートだった PowerShell が、実行環境のバージョンが上がったとかで v2 になり、選べなくなっているみたい？一時的な話？
実行環境を作る https://portal.azure.com/ から 「リソースの作成」「Serverless Function App」と選択していきます。">

        <link href="https://yukihane.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://yukihane.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://yukihane.github.io/">発火後忘失</a>
	</div>
	<nav>
		
		<a href="/blog">Blog</a>
		
		<a href="/docs">Docs</a>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Azure FunctionsでPowerShell使えなくなっとる</h1>
          <div class="meta">Posted on 2018/09/29</div>
        </div>
        
        <section class="body">
          <p>v1 で実験的サポートだった PowerShell が、実行環境のバージョンが上がったとかで v2 になり、選べなくなっているみたい？一時的な話？</p>
<h1 id="実行環境を作る">実行環境を作る</h1>
<p><a href="https://portal.azure.com/">https://portal.azure.com/</a> から 「リソースの作成」「Serverless Function App」と選択していきます。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/832a26fb-6420-c0b8-75ae-fc2a92045c13.png" alt="functions01.png"></p>
<p>入力項目を適当に埋めていきます。PowerShell で作りたいので当然ながら<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>OS は「Windows」、ランタイムスタックは「.NET」。<br />
Application Insights は何かよく分からないのでオフ<br />
にしました。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/4219d384-eb5b-face-e53e-74ad6a02b15d.png" alt="functions02.png"></p>
<p>入力を終え画面下部の「作成」ボタンを押すとデプロイ作業が始まり、少し待たされます。<br />
デプロイ作業が完了すると通知が表示されます。その通知からも行けますし、そうでない場合は画面左の「Function App」メニューから関数作成ウィザードに行けます。<br />
「関数」ツリーメニューの右にあるプラスアイコンをクリックし、その次に今回作りたいプロジェクトのひな型を選びます。<br />
今回は「In-portal」を選択しました。<br />
選択が完了したら画面下部の「続行」ボタンを押します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/f5c59661-29d9-526b-99e4-56ce8f76b68c.png" alt="functions03.png"></p>
<p>今回タイマー駆動の処理が行いたいので「タイマー」を選択し、その後画面下部の「作成」ボタンを押します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/4e866cba-1977-dd9f-385e-010337c1321b.png" alt="functions04.png"></p>
<p>すると…めでたく C#の関数が生成されました！</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/40b97c1e-5d2c-0157-c1d8-c067662768f3.png" alt="functions05.png"></p>
<p>ってなんでやねん！PowerShell で作りたい言うとるやろ！言語選ばせろや 💢</p>
<h1 id="作成した実行環境の設定を変更する">作成した実行環境の設定を変更する</h1>
<h2 id="ランタイムバージョンを変更する">ランタイムバージョンを変更する</h2>
<p>現在デフォルトのランタイムバージョンが 2 なので 1 に下げます。PowerShell は今のところバージョン 1 でしか選択できません。</p>
<p>まず、先ほど作成した関数を削除します。残したままだと設定変更できません。</p>
<p>ツリーメニュー上で、作成した関数名の 1 つ上の階層「関数」メニューを選択し、表れた関数名一覧の右端にあるごみ箱アイコンを選択し削除実行します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/0e5b87a0-dff0-d7df-dde6-5874c88ca6af.png" alt="functions06.png"></p>
<p>つづいて、先ほど選択した関数メニューの更に 1 階層上、&lt;app 名&gt;(ここでは hello-azure-functionz)を選択し、右側の表示「プラットフォーム機能」タブがアクティブであることを確認します。<br />
そのタブ表示の中から、「Function App の設置」を選択します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/303fc5ac-2191-ccc4-383d-7c84afadd926.png" alt="functions07.png"></p>
<p>「ランタイムバージョン」が「~2」になっているので、これを <strong>「~1」に変更します</strong>。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/3d380c06-ace5-4dc2-fe75-dbbab5e470d6.png" alt="functions08.png"></p>
<h2 id="アプリケーション設定-functions_worker_runtime-を削除する">アプリケーション設定 FUNCTIONS_WORKER_RUNTIME を削除する</h2>
<p>本来であれば、ここまでの設定を行えば v1 がサポートしている言語が使えて然るべきだと思うのですが、まだ PowerShell がウィザードに表れません。</p>
<p>そこで次に説明する設定変更を行います。<br />
さきほどの「プラットフォーム機能」タブに戻り、今度は「アプリケーション設定」を選択します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/b75dbb1c-057c-8c48-2eed-20b6430c1d39.png" alt="functions09.png"></p>
<p>開いたタブを少し下にスクロールし、「アプリケーション設定」セクションを探します。<br />
この中で「<strong>FUNCTIONS_WORKER_RUNTIME</strong>」というアプリ設定名がありますので、これを削除します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/527a38f5-4a83-2bef-9688-f9152a7ea420.png" alt="functions10.png"></p>
<p>そして、その画面の上部にある「保存」アイコンを選択し変更を反映してください。</p>
<p>設定は以上です。</p>
<h1 id="powershell-関数を作成してみる">PowerShell 関数を作成してみる</h1>
<p>PowerShell 関数を作成できるようになっていることを確認してみましょう。</p>
<p>関数を新規作成するために、「関数」メニュー右のプラスアイコンを選択します。<br />
そうすると、設定変更作業前とは異なる画面が表示されます。</p>
<p>ここで「カスタム関数を作成する」を選択します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/8266638a-a227-c827-6b9f-ddfd4586582c.png" alt="functions11.png"></p>
<p>次の画面で、「実験的な言語のサポート」を有効にすれば選択肢に PowerShell が表れます。<br />
ここでは「Timer trigger」を選択します。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/a57aa37c-644f-6cd6-9c67-c6bcee817232.png" alt="functions12.png"></p>
<p>言語で「PowerShell」を選択し、あとは適当に入力して「作成」を押せば関数作成完了です。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/85594/c3449ddf-c714-7819-d550-66f3a2624bb1.png" alt="functions13.png"></p>
<h1 id="参考">参考</h1>
<ul>
<li><a href="https://stackoverflow.com/a/52523654/4506703">unable to create a python function app in azure function runtime v1 - Stack Overflow</a></li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn:1">
<p>いや AWS Lambda の PowerShell(Core)環境は Amazon Linux なので当然ということでもないか。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/azure">azure</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2025  &amp;copy;{year}, All Rights Reserved |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-E9J8FN5B4Q"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-E9J8FN5B4Q');
        }
      </script>

</div>
    </body>
</html>
