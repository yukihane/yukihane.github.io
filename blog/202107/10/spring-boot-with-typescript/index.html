<!DOCTYPE html>
<html><head lang="ja">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Spring BootとTypeScriptで開発するためのプロジェクト設定(Gradle) - 発火後忘失</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="はじめに
Spring Boot で JavaScript を扱うときは素のJSをhtml(Thymeleafテンプレート)に &lt;script&gt; タグで埋め込む、というのが多分一般的で手っ取り早い方法かと思います。" />
	<meta property="og:image" content="https://yukihane.github.io/"/>
	<meta property="og:url" content="https://yukihane.github.io/blog/202107/10/spring-boot-with-typescript/">
  <meta property="og:site_name" content="発火後忘失">
  <meta property="og:title" content="Spring BootとTypeScriptで開発するためのプロジェクト設定(Gradle)">
  <meta property="og:description" content="はじめに Spring Boot で JavaScript を扱うときは素のJSをhtml(Thymeleafテンプレート)に &lt;script&gt; タグで埋め込む、というのが多分一般的で手っ取り早い方法かと思います。">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2021-07-09T22:54:04+00:00">
    <meta property="article:modified_time" content="2021-07-09T22:54:04+00:00">
    <meta property="article:tag" content="Spring-Boot">
    <meta property="article:tag" content="Javascript">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Spring BootとTypeScriptで開発するためのプロジェクト設定(Gradle)">
  <meta name="twitter:description" content="はじめに Spring Boot で JavaScript を扱うときは素のJSをhtml(Thymeleafテンプレート)に &lt;script&gt; タグで埋め込む、というのが多分一般的で手っ取り早い方法かと思います。">

        <link href="https://yukihane.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://yukihane.github.io/css/main.a0a79e0f1e1b1461143426d13d803a6ca343eab47102f3e6b899d9c06bbd5134.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://yukihane.github.io/css/dark.f163b79c6de51d14a766ff9f0563053de7f06a4d1bf7b85a59608bf96e566710.css"  disabled />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://yukihane.github.io/">発火後忘失</a>
	</div>
	<nav>
		
		<a href="/blog">Blog</a>
		
		<a href="/docs">Docs</a>
		
		<a href="/tags">Tags</a>
		
		<a href="https://github.com/yukihane/resume/blob/main/README.md">Resume</a>
		
		<button id="dark-mode-toggle" class="nav-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode" type="button"><svg class="feather" viewBox="0 0 24 24" fill="none" stroke="#232333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg></button>
		<script src="https://yukihane.github.io/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Spring BootとTypeScriptで開発するためのプロジェクト設定(Gradle)</h1>
          <div class="meta">Posted on 2021/07/09</div>
        </div>
        
        <section class="body">
          <h1 id="はじめに">はじめに</h1>
<p>Spring Boot で JavaScript を扱うときは素のJSをhtml(Thymeleafテンプレート)に <code>&lt;script&gt;</code> タグで埋め込む、というのが多分一般的で手っ取り早い方法かと思います。</p>
<p>ただ、そろそろ素のJSを書くのをやめたい、という思いもあり、今回設定方法を考え、記録しました。</p>
<p>私は普段はMavenを使っているのですが、今回は事情によりGradleプロジェクトの設定方法です。 (Mavenでも同じ方針で実現できると思います)</p>
<p>今回の実証コードはこちらです:</p>
<ul>
<li><a href="https://github.com/yukihane/hello-java/tree/master/spring/with-ts">https://github.com/yukihane/hello-java/tree/master/spring/with-ts</a></li>
</ul>
<h1 id="手順">手順</h1>
<h2 id="spring-boot-プロジェクトを構成する">Spring Boot プロジェクトを構成する</h2>
<p><a href="https://start.spring.io/">https://start.spring.io/</a> で、Webアプリケーションを構成します。</p>
<p>今回は次のdependenciesを追加しました。</p>
<ul>
<li>
<p>Spring Boot DevTools</p>
</li>
<li>
<p>Lombok</p>
</li>
<li>
<p>Spring Configuration Processor</p>
</li>
<li>
<p>Spring Web</p>
</li>
<li>
<p>Thymeleaf</p>
</li>
</ul>
<p>Project は、冒頭に記載した通り今回は &ldquo;Gradle Project&rdquo; を選択します。</p>
<p><code>build.gradle</code> にデフォルトで導入するプラグインをセットアップします。</p>
<div class="formalpara-title">
<p><strong>build.gradle</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">plugins</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">id</span> <span class="s1">&#39;eclipse&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">id</span> <span class="s1">&#39;com.diffplug.eclipse.apt&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.30.0&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">id</span> <span class="s1">&#39;com.dorongold.task-tree&#39;</span> <span class="n">version</span> <span class="s1">&#39;2.1.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Eclipseプロジェクトを構成します。</p>
<pre><code>gradle build cleanEclipse eclipse
</code></pre>
<p>Eclipse メニューの <strong>File &gt; Import</strong> を選択し、ダイアログの <strong>General &gt; Existing Projects into Workspace</strong> から今回のプロジェクトをインポートします。</p>
<h3 id="補足">補足</h3>
<p>GradleプロジェクトをEclipse(Spring Tools 4 for Eclipse)にインポートする手順は次のエントリで説明しています。</p>
<ul>
<li><a href="/blog/202007/26/spring-boot-gradle-eclipse/">GradleでSpring Bootプロジェクトを作成してSTS(Eclipse)でインポートする手順</a> – 発火後忘失</li>
</ul>
<h2 id="yarn-プロジェクトを構成する">Yarn プロジェクトを構成する</h2>
<p>上記で作成したGradleプロジェクトのルートディレクトリでYarnプロジェクトを生成します。</p>
<pre><code>yarn init -y
yarn add --dev webpack webpack-cli
yarn webpack init
</code></pre>
<p><code>yarn webpack init</code> を実行するとインタラクティブにプロジェクトが構成されます。 それぞれの質問には次のように返答します:</p>
<table>
  <thead>
      <tr>
          <th>質問</th>
          <th>返答</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Would you like to install &lsquo;@webpack-cli/generators&rsquo; package?</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>Which of the following JS solutions do you want to use?</td>
          <td>Typescript</td>
      </tr>
      <tr>
          <td>Do you want to use webpack-dev-server?</td>
          <td>No</td>
      </tr>
      <tr>
          <td>Do you want to simplify the creation of HTML files for your bundle?</td>
          <td>No</td>
      </tr>
      <tr>
          <td>Do you want to add PWA support?</td>
          <td>No</td>
      </tr>
      <tr>
          <td>Which of the following CSS solutions do you want to use?</td>
          <td>none</td>
      </tr>
      <tr>
          <td>Do you like to install prettier to format generated configuration?</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>Overwrite package.json?</td>
          <td>y (overwrite)</td>
      </tr>
  </tbody>
</table>
<p>続いて、不要なファイルが生成されているので削除します:</p>
<pre><code>rm README.md index.html src/index.ts
</code></pre>
<p><code>tsconfig.json</code> を次のように書き換えます:</p>
<div class="formalpara-title">
<p><strong>tsconfig.json</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;compilerOptions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;strict&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;module&#34;</span><span class="p">:</span> <span class="s2">&#34;es6&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;target&#34;</span><span class="p">:</span> <span class="s2">&#34;es5&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>javascript</code> ファイルは <code>src/main/js</code> に、そして出力は <code>build/resources/main/static/static</code> に出力するよう設定します。 また、 <code>mylib</code> という名前のライブラリとして生成します。</p>
<div class="formalpara-title">
<p><strong>webpack.config.js</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Generated using webpack-cli https://github.com/webpack/webpack-cli
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">isProduction</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">==</span> <span class="s2">&#34;production&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// https://webpack.js.org/concepts/output/#multiple-entry-points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// https://webpack.js.org/configuration/output/#outputlibrary
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mylib</span><span class="o">:</span> <span class="s2">&#34;./src/main/js/index.ts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">library</span><span class="o">:</span> <span class="s2">&#34;[name]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;build/resources/main/static/static&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Add your plugins here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Learn more about plugins from https://webpack.js.org/configuration/plugins/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(ts|tsx)$/i</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;ts-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;/node_modules/&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// Add your rules for custom modules here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// Learn more about loaders from https://webpack.js.org/loaders/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;.tsx&#34;</span><span class="p">,</span> <span class="s2">&#34;.ts&#34;</span><span class="p">,</span> <span class="s2">&#34;.js&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">isProduction</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="s2">&#34;production&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="s2">&#34;development&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span><span class="p">.</span><span class="nx">devtool</span> <span class="o">=</span> <span class="s2">&#34;inline-source-map&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="補足-1">補足</h3>
<p><code>yarn add</code> の対象は次のページを参考にしました:</p>
<ul>
<li><a href="https://webpack.js.org/guides/getting-started/#basic-setup">Getting Started | webpack</a></li>
</ul>
<p><code>webpack.config.js</code> の設定は、 `ts-loader`のリファレンス中で <a href="https://github.com/TypeStrong/ts-loader#examples">&ldquo;simplest&rdquo;</a> と表現されていた <a href="https://github.com/TypeStrong/ts-loader/tree/main/examples/vanilla">こちらのサンプル</a> も参考にしています。</p>
<p>また、次の説明も参考にしています:</p>
<ul>
<li>
<p><a href="https://webpack.js.org/concepts/output/#multiple-entry-points">Output &gt; Multiple Entry Points | webpack</a></p>
</li>
<li>
<p><a href="https://webpack.js.org/configuration/output/#outputlibrary">Output &gt; output.library | webpack</a></p>
</li>
</ul>
<h2 id="yarn-を-gradle-に統合する">Yarn を Gradle に統合する</h2>
<p><code>gradle build</code> で ts のビルドも含めて実行できるようにします。</p>
<p><a href="https://github.com/node-gradle/gradle-node-plugin"><code>gradle-node-plugin</code></a> を導入し、 task の依存関係を設定します:</p>
<div class="formalpara-title">
<p><strong>build.gradle</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">plugins</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">id</span> <span class="s1">&#39;com.github.node-gradle.node&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.1.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">yarn_build</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">yarn_install</span>
</span></span><span class="line"><span class="cl"><span class="n">processResources</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">yarn_build</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ビルドしてみる">ビルドしてみる</h2>
<p>設定はここまでで完了しました。 試しにサンプルコードをおいてビルドしてみます。</p>
<p>なお、サンプルコードでは <a href="https://github.com/faisalman/ua-parser-js"><code>UAParser.js</code></a> を利用していますので、事前に</p>
<pre><code>yarn add ua-parser-js
yarn add --dev @types/ua-parser-js
</code></pre>
<p>を実行しています。</p>
<p>以下、サンプルコード:</p>
<div class="formalpara-title">
<p><strong>src/main/java/com/github/yukihane/withts/MyController.java</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&#34;now&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;index&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="formalpara-title">
<p><strong>src/main/resources/templates/index.html</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ja&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">table</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">td</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">th</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>サーバ時刻<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">td</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;server&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>ブラウザ<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">td</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;client&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span>
</span></span><span class="line"><span class="cl">      <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">src</span><span class="o">=</span><span class="s">&#34;../../../../build/resources/main/static/static/mylib.js&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">th:src</span><span class="o">=</span><span class="s">&#34;@{/static/mylib.js}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">th:inline</span><span class="o">=</span><span class="s">&#34;javascript&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;DOMContentLoaded&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">serverTime</span> <span class="o">=</span> <span class="cm">/*[[${now}]]*/</span> <span class="s2">&#34;2020-01-01T10:10:10.000+09:00&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;server&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">server</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">serverTime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">clientTime</span> <span class="o">=</span> <span class="nx">mylib</span><span class="p">.</span><span class="nx">getOS</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;client&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">client</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">clientTime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="formalpara-title">
<p><strong>src/main/js/index.ts</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">UAParser</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;ua-parser-js&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">getOS</span> <span class="o">=</span> <span class="p">(</span><span class="nx">userAgent</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UAParser</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">parser</span><span class="p">.</span><span class="nx">getOS</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上記のソースを作成し終わったら、ビルドし、実行してみます:</p>
<pre><code>gradle clean build
java -jar build/libs/with-ts-0.0.1-SNAPSHOT.jar
</code></pre>
<p><a href="http://localhost:8080">http://localhost:8080</a> にアクセスすると、サーバ側で取得した時刻がThymeleafによって挿入され、また、ブラウザ側で取得したOS情報が JavaScript によって挿入されているのが確認できます。</p>
<h2 id="hot-swapping-するコード変更を自動反映する">Hot Swapping する(コード変更を自動反映する)</h2>
<p>前述の方法は <code>jar</code> を作成して実行するものでしたが、これでは開発がやりにくいので、ソースを編集したらリアルタイムで反映してくれるように実行方法を工夫します。</p>
<p>まず、TypeScriptの更新が行われたら自動でビルドするようにwatchします。</p>
<pre><code>yarn watch
</code></pre>
<p>Java側の変更を検知してビルドし直すようにgradleでwatchします。</p>
<pre><code>gradle -t classes -x yarn_build
</code></pre>
<p>サーバを起動します。</p>
<pre><code>gradle bootRun -x yarn_build
</code></pre>
<p>これで、TypeScript, Java 等のコードを修正し保存すると自動でSpring Bootが再起動し反映されるようになりました。</p>
<h2 id="spring-boot-プロセスにデバッガeclipseをアタッチする">Spring Boot プロセスにデバッガ(Eclipse)をアタッチする</h2>
<p>はじめに、起動時に suspend する必要がなければ、次の設定を行っておきます:</p>
<div class="formalpara-title">
<p><strong>build.gradle</strong></p>
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">bootRun</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">debugOptions</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">suspend</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>そして、前節で説明した最後のコマンド <code>gradle bootRun -x yarn_build</code> に、 <code>--debug-jvm</code> オプションを付けて実行します:</p>
<pre><code>gradle bootRun -x yarn_build --debug-jvm
</code></pre>
<p>これでデバッガをアタッチできるような状態でSpring Bootが起動しました。</p>
<p>続いて、Eclipse側で設定を行いアタッチします。</p>
<ol>
<li>
<p>メニューから <strong>Run &gt; Debug Configurations</strong> を選択します。</p>
</li>
<li>
<p><strong>Remote Java Application</strong> を右クリックし、 <strong>New Configuration</strong> を選択します。</p>
</li>
<li>
<p><strong>Project</strong> に今回のプロジェクトを設定します。 <strong>Port</strong> を <code>5005</code> に設定変更します。</p>
</li>
</ol>
<p>設定が完了したら、 Debug ボタンを押してデバッグを開始します。</p>
<h3 id="補足-2">補足</h3>
<p>Eclipse をアタッチしている状態で Eclipse で Javaコードを編集した場合、デバッガ経由で変更が反映されるので <code>gradle -t classes -x yarn_build</code> は必要ありません。 (ただし、静的リソースファイルなどの更新は検知できなくなります)</p>
<p>Grdleプロジェクトのデバッグオプションについてはこちらに記載しています:</p>
<ul>
<li>
<p><a href="/blog/202006/15/spring-boot-debugging/">Spring BootのGradleでのデバッグ実行方法</a> – 発火後忘失</p>
</li>
<li>
<p><a href="https://stackoverflow.com/a/62567812/4506703">debug gradle bootRun having server=n</a> - Stack Overflow</p>
</li>
</ul>
<h2 id="自動テストを実行するjest">自動テストを実行する(Jest)</h2>
<p>説明が前後してしまいますが、次の記事を参照してください。 次の記事はBabelを組み込む方法ですが、Jestに関しては同じ設定でいけるはずです。</p>
<ul>
<li><a href="/blog/202107/11/spring-boot-with-babel/">Spring BootとTypeScriptで開発するためのプロジェクト設定(Gradle) - Polyfillも必要とする場合</a></li>
</ul>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/spring-boot/">spring-boot</a></li>
              
              <li><a href="/tags/javascript/">javascript</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/yukihane" rel="me" title="GitHub"><svg class="feather">
       <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github" />
    </svg></a><a class="border"></a></div>
  <div class="footer-info">
    2026  © Yukihane, All Rights Reserved |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-E9J8FN5B4Q"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-E9J8FN5B4Q');
        }
      </script>

</div>
    </body>
</html>
